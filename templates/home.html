<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Packages</title>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
</head>

<style type="text/css">
  .container {
    margin-top: 2%;
  }

  .list-group {
    max-height: 80vh;
    margin-bottom: 5vh;
    overflow: scroll;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
  }

  .list-group::-webkit-scrollbar {
    width: 4px;
  }

  .list-group::-webkit-scrollbar-track {
    background-color: black;
  }

  .list-group::-webkit-scrollbar-thumb {
    height: 40px;
    background-color: #d90e00;
  }
</style>

{% block main %}

<body>
  <div class="container">
    <div class="row">
      <div class="col-4">
        <h1>Packages ({{names|count}})</h1>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <div class="list-group" id="list-tab" role="tablist">
          {% for name in names %}
          <a class="list-group-item list-group-item-action" id="list-home-list" onclick="submitRequest(this.text);" data-toggle="list" role="tab" aria-controls="{{name}}">{{name}}</a>
          {% endfor %}
        </div>
      </div>
      <div class="col-8">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">
            <h2 id="packageName"></h2>
            <p id="packageDesc"></p>
            <br>
            <button type="button" class="btn btn-light" id="packageDepends"></button>
            <br>
            <button type="button" class="btn btn-light" id="packageInvDepends"></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

{% endblock %}

{% block script %}

<script type="text/javascript">
  function submitRequest(a) {
    console.log(a);
    var entry = {
      name: a
    };

    fetch(window.origin + "/return-package", {
        method: "POST",
        credentials: "include",
        body: JSON.stringify(entry),
        cache: "no-cache",
        headers: new Headers({
          "content-type": "application/json"
        })
      })
      .then(function(response) {
        if (response.status !== 200) {
          console.log("Error happened: ${response.status}");
          return;
        }
        response.json().then(function(data) {
          $('#packageName').text(data['package']['name'])
          $('#packageDesc').text(data['package']['desc'])
          $('#packageDepends').text(data['package']['depends'])
          $('#packageInvDepends').text(data['package']['invDepends'])
        });
      })
      .catch(function(error) {
        console.log("Fetch error: " + error);
      });

  }
</script>

{% endblock %}

</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Packages</title>
  <script type="text/javascript" src="/static/jquery/jquery-3.4.1.min.js"></script>
  <script src="/static/bootstrap/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/static/styles/style.css">
</head>

<body onload="getFirst();">

  <div class="container">
    <div class="row">
      <div class="col-4">
        <h1>Packages ({{names|count}})</h1>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="col-4">
        <div class="list-group" id="list-tab" role="tablist">
          {% for name in names %}
          <a class="list-group-item list-group-item-action" href="#" id="list-home-list" onclick="submitRequest(this.text)" data-toggle="list" role="tab" aria-controls="{{name}}">{{name}}</a>
          {% endfor %}
        </div>
      </div>
      <div class="col-8">
        <div class="tab-content" id="nav-tabContent">
          <div class="tab-pane fade show active" id="list-settings" role="tabpanel" aria-labelledby="list-settings-list">
            <h2 id="packageName"></h2>
            <pre id="packageDesc"></pre>
            <div class="depend-list">
            </div>
            <br>
            <div class="inv-depend-list">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script type="text/javascript">
  function submitRequest(a) {
    var entry = {
      name: a
    };

    fetch(window.origin + "/return-package", {
        method: "POST",
        credentials: "include",
        body: JSON.stringify(entry),
        cache: "no-cache",
        headers: new Headers({
          "content-type": "application/json"
        })
      })
      .then(function(response) {
        if (response.status !== 200) {
          console.log("Error happened: ${response.status}");
          return;
        }
        response.json().then(function(data) {
          $('#packageName').text(data['package']['name']);
          $('#packageDesc').text(data['package']['desc']);
          listDepends(data['package']['depends'])
          listInvDepends(data['package']['invDepends'])
        });
      })
      .catch(function(error) {
        console.log("Fetch error: " + error);
      });
  }

  function listDepends(a) {
    $('.depend-list').empty();
    if (a) {
      $('.depend-list').append('<p class="depend">Dependecies:</p>');
      a.forEach(element => $('.depend-list').append('<a href="#" type="link" onclick="submitRequest(this.text)">' + element + ' </a>'));
    }
  }

  function listInvDepends(a) {
    $('.inv-depend-list').empty();
    if (a) {
      $('.inv-depend-list').append('<p class="depend">Inverse dependecies:</p>');
      a.forEach(element => $('.inv-depend-list').append('<a href="#" type="link" onclick="submitRequest(this.text)">' + element + ' </a>'));
    }
  }

  function getFirst() {
    submitRequest("{{names[0]}}");
  }
</script>

</html>
